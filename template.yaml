#############################################################################
# TEMPLATE BINARY SENSOR
# ###########################################################################

# dark or not
# people home or not
#
- binary_sensor:
  - name: Sufficient Outdoor Illumination
    unique_id: sufficient_outdoor_illumination
    state: >-
      {% set sun_shining = states('sensor.solar_now_watts') | float > 100 %}

      {{ sun_shining }}

  - name: Porch - Light Should be Off
    unique_id: porch_light_should_be_off
    state: >-
      {% set day = is_state('sensor.period_of_day', 'day') %}
      {% set sun_shining = is_states('binary_sensor.sufficient_outdoor_illumination', 'on') %}

      {{ day and sun_shining }}

  - name: Porch - Light should be on high
    unique_id: porch_light_should_be_on_high
    state: >-
      {% set motion = is_state('binary_sensor.porch_person_motion', 'on') %}
      {% set front_door = is_state('binary_sensor.front_door', 'on') %}
      {% set not_off = is_state('binary_sensor.porch_light_should_be_off', 'on') %}

      {{ not_off and (motion or front_door) }}

  - name: Porch - Light should be low
    unique_id: porch_light_should_be_on_low
    state: >-
      {% set not_night = not is_state('sensor.period_of_day', 'night') %}
      {% set no_event = is_state('binary_sensor.porch_light_should_be_on_high', 'off') %}
      {% set not_off = is_state('binary_sensor.porch_light_should_be_off', 'on') %}

      {{ no_event and not_night and not_off}}

  - name: Porch - Light should be on medium
    unique_id: porch_light_should_be_on_medium
    state: >-
      {% set no_event = is_state('binary_sensor.porch_light_should_be_on_high', 'off') %}
      {% set is_night = is_state('sensor.period_of_day', 'night') %}
      {% set not_off = is_state('binary_sensor.porch_light_should_be_off', 'on') %}

      {{ is_night and no_event and not_off }}

- sensor:
  - name: Porch Light Desired Brightness
    unique_id: porch_light_desired_brightness
    unit_of_measurement: "%"
    state: >
      {% if is_state('binary_sensor.porch_light_should_be_off', 'on') %}
      0.0
      {% elif is_state('binary_sensor.porch_light_should_be_on_low', 'on') %}
      25.0
      {% elif is_state('binary_sensor.porch_light_should_be_on_medium', 'on') %}
      50.0
      {% elif is_state('binary_sensor.porch_light_should_be_on_high', 'on') %}
      100.00
      {% endif %}

